<?xml version="1.0" encoding="UTF-8"?>
<templates>

    <!--
        Chatter attachment tab
    -->

    <t t-name="mail.chatter.AttachmentBox">
        <div class="o_chatter_attachment">
            <div class="o_border_dashed">
                <span class="o_attach_title">Attachments</span>
            </div>
            <div t-if="imageList.length > 0" class="o_attachments_previews">
                <t t-foreach="imageList" t-as="attachment">
                    <t t-call="mail.AttachmentImage"/>
                </t>
            </div>
            <div t-if="otherList.length > 0" class="o_attachments_list">
                <t t-foreach="otherList" t-as="attachment">
                    <t t-call="mail.AttachmentOther"/>
                </t>
            </div>
        </div>
    </t>

    <t t-name="mail.AttachmentImage">
        <div class="o_attachment" t-att-title="attachment.name">
            <div class="o_attachment_wrap">
                <div class="o_image_box">
                    <div class="o_attachment_image" t-attf-style="background-image:url('/web/image/#{attachment.id}/160x160/?crop=true')"/>
                    <div t-attf-class="o_image_overlay o_attachment_view"  t-att-data-id="attachment.id">
                        <span class="o_attachment_title text-white"><t t-esc="attachment.name"/></span>
                        <a class="o_attachment_download" t-att-href="'/web/content/'+attachment.id+'?download=true'">
                            <i t-attf-class="fa fa-download text-white" t-att-title="'Download ' + attachment.name" aria-hidden="true"/>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </t>

    <t t-name="mail.AttachmentOther">
        <t t-set="type" t-value="attachment.mimetype and attachment.mimetype.split('/').shift()"/>
        <div t-attf-class="o_attachment #{ editable ? 'o_attachment_editable' : '' } #{attachment.upload ? 'o_attachment_uploading' : ''}" t-att-title="attachment.name">
            <div class="o_attachment_wrap">
                <t t-set="has_preview" t-value="type == 'image' or type == 'video' or attachment.mimetype == 'application/pdf'"/>
                <t t-set="ext" t-value="attachment.datas_fname.split('.').pop()"/>

                <div t-attf-class="o_image_box pull-left #{has_preview ? 'o_attachment_view' : ''}" t-att-data-id="attachment.id">
                    <div t-if="has_preview"
                         class="o_image o_hover"
                         t-att-style="type == 'image' ? 'background-image:url(/web/image/' + attachment.id + '/38x38/?crop=true' : '' "
                         t-att-data-mimetype="attachment.mimetype">
                    </div>
                    <a t-elif="!editable" t-att-href="'/web/content/'+attachment.id+'?download=true'" t-att-title="'Download ' + attachment.name">
                        <span class="o_image o_hover" t-att-data-mimetype="attachment.mimetype" t-att-data-ext="ext"/>
                    </a>
                    <span t-else="" class="o_image" t-att-data-mimetype="attachment.mimetype" t-att-data-ext="ext"/>
                </div>

                <div class="caption">
                    <span t-if="has_preview or editable" t-attf-class="ml4 #{has_preview? 'o_attachment_view' : ''}" t-att-data-id="attachment.id"><t t-esc='attachment.name'/></span>
                    <a t-else="" class="ml4" t-att-href="'/web/content/'+attachment.id+'?download=true'" t-att-title="'Download ' + attachment.name"><t t-esc='attachment.name'/></a>
                </div>
                <div t-if="editable" class="caption small">
                    <b t-attf-class="ml4 small text-uppercase #{has_preview? 'o_attachment_view' : ''}" t-att-data-id="attachment.id"><t t-esc="ext"/></b>
                    <div class="progress o_attachment_progress_bar">
                        <div class="progress-bar progress-bar-striped active" style="width: 100%">Uploading</div>
                    </div>
                </div>
                <div t-if="!editable" class="caption small">
                    <b t-if="has_preview" class="ml4 small text-uppercase o_attachment_view" t-att-data-id="attachment.id"><t t-esc="ext"/></b>
                    <a t-else="" class="ml4 small text-uppercase" t-att-href="'/web/content/'+attachment.id+'?download=true'" t-att-title="'Download ' + attachment.name"><b><t t-esc='ext'/></b></a>
                    <a class="ml4 o_attachment_download pull-right" t-att-title="'Download ' + attachment.name" t-att-href="'/web/content/'+attachment.id+'?download=true'"><i t-attf-class="fa fa-download"/></a>
                </div>
                <div t-if="editable" class="o_attachment_uploaded"><i class="text-success fa fa-check"/></div>
                <div t-if="editable" class="o_attachment_delete" t-att-data-id="attachment.id"><span class="text-white">Ã—</span></div>
            </div>
        </div>
    </t>

    <!--
        Chatter composer

        @param {mail.composer.Chatter} widget
    -->

    <t t-name="mail.chatter.Composer" t-extend="mail.Composer">
        <!-- Insert information before the composer -->
        <t t-jquery=".o_composer_container" t-operation="before">
            <!-- New message composer -->
            <t t-if="!widget.options.isLog">
                <!-- Text for followers -->
                <small class="o_chatter_composer_info">
                    <b class="text-muted">To: </b>
                    <em class="text-muted">Followers of </em>
                    <b>
                        <t t-if="widget.options.recordName">
                            &#32;&quot;<t t-esc="widget.options.recordName"/>&quot;
                        </t>
                        <t t-if="!widget.options.recordName">
                            this document
                        </t>
                    </b>
                </small>
                <!-- List of followers -->
                <div class="o_composer_suggestedPartners">
                    <t t-foreach='widget.suggestedPartners' t-as='recipient'>
                        <div t-attf-title="Add as recipient and follower (reason: #{recipient.reason})">
                            <div class="custom-control custom-checkbox">
                                <input type="checkbox"
                                       class="custom-control-input"
                                       t-attf-id="o_composer_suggested_partners_p#{recipient_index}"
                                       t-att-checked="recipient.checked ? 'checked' : undefined"
                                       t-att-data-fullname="recipient.full_name"/>
                                <label t-attf-for="o_composer_suggested_partners_p#{recipient_index}" class="custom-control-label">
                                    <t t-esc="recipient.name"/>
                                    <t t-if="recipient.email_address">(<t t-esc="recipient.email_address"/>)</t>
                                </label>
                            </div>
                        </div>
                    </t>
                </div>
            </t>
        </t>

        <!-- Add a button to open the full composer dialog -->
        <t t-jquery=".o_composer_button_add_attachment" t-operation="after">
            <button tabindex="6" class="btn btn-secondary fa fa-expand o_composer_button_full_composer" type="button" title="Full composer" aria-label="Full composer"/>
        </t>
    </t>

    <!--
        Chatter (mail_thread widget) buttons

        @param {boolean} [isMobile]
        @param {boolean} [logNoteButton]
        @param {boolean} [newMessageButton]
        @param {boolean} [scheduleActivityButton]
    -->
    <t t-name="mail.chatter.Buttons">
        <button t-if="newMessageButton" type="button" class="btn btn-link o_chatter_button_new_message" title="Send a message" disabled="disabled">
            Send message
        </button>
        <button t-if="logNoteButton" class="btn btn-link o_chatter_button_log_note" title="Log a note. Followers will not be notified." disabled="disabled">
            Log note
        </button>
        <button t-if="scheduleActivityButton" class="btn btn-link o_chatter_button_schedule_activity" title="Log or schedule an activity" disabled="disabled">
            <i class="fa fa-clock-o" role="img" aria-label="Dates" title="Dates"/> <t t-if="isMobile">Activity</t><t t-else="">Schedule activity</t>
        </button>

    </t>

    <t t-name="mail.chatter.Attachment.Button">
        <span class="o_attachment_button_area">
        <button class="btn btn-sm btn-link o_chatter_button_attachment" title="View all the attachments of the current record">
            <span><i class="fa fa-paperclip"/><t t-esc="' ('+count+')'"/></span>
        </button>
        </span>
    </t>

    <!--
        Chatter main div
    -->
    <t t-name="mail.Chatter">
        <aside class="o_chatter">
            <div class="o_chatter_topbar"/>
        </aside>
    </t>

</templates>
